<!DOCTYPE html>
<html lang="en">
  <head>
  {% load staticfiles %}
  <link href="{% static "WONKA/bootstrap.css" %}" media="screen" rel="stylesheet"/>
  <script src="{% static "OOMMPPAA/jquery-1.7.min.js" %}"></script>
  <script src="{% static "WONKA/bootstrap.min.js" %}"></script>
  <script src="{% static "WONKA/filesaver.js" %}"></script>
  <script src="{% static "OOMMPPAA/spin.js" %}"></script>
   <script src="{% static "WONKA/base_64.min.js" %}"></script>
  <script src="{% static "OOMMPPAA/ICM_funs.js" %}"></script>
  <link rel="shortcut icon" href="{% static "OOMMPPAA/icon.ico" %}" type="image/x-icon">
  <script src="{% static "OOMMPPAA/bootstrap-slider.js" %}"></script>
  <link rel="stylesheet" href="{% static "OOMMPPAA/bootstrap.min.css" %}">
  <link rel="stylesheet" href="{% static "OOMMPPAA/slider.css" %}">
   <title>WONKA: {{ target.title }}</title>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta charset="utf-8">
 
  </head>
  <body>
  <style>.modal-dialog{
position: absolute;
left: 50%;
//now you must set a margin left under zero - value is a half width your window
margin-left: -312px;
// this same situation is with height - example
height: 800px;
top: 10%;

} 

.carousel-control {
  padding-top:10%;
  width:5%;
}

.protClass
{
border-style:dashed;
border-color:grey;
}

.waterClass
{
outline: 2px blue dashed;
}

.ph4Class
{
box-shadow: 0 0 0 3px hsl(0, 0%, 80%);
}


.coveringCanvas{ 
    z-index:100000000000000;
    background-color: rgba(0,0,0,.1);
}
.img_class{
    position:relative;
    z-index:1;
}
.container{
    display:inline-block;
    width:49%; 
    margin: 0 auto; 
    position:relative;
    }
    
.btn-on{

	border-color: #FD0000;


}
.btn-off{

	border-color: #484857;

}

</style>


<script>




function get_pk_list(){
// Function to get a list of pks given a particular button

}


function show_mol(pdb_code, on_switch){
// Molecule to take a smiles and a pk to fill a mol on click
var url_string = mybase+'/Viewer/loader/?choice='+pdb_code+'&function=VIEWMOL';

if (on_switch==true){

runCommand('delete a_'+pdb_code+'*. ');


}

else{
runCommand('read mol "'+url_string+'"');
runCommand("display a_*. wire");

};


}
function show_mol_check(pdb_code, div_name, colour){
// Molecule to take a smiles and a pk to fill a mol on click
var url_string = mybase+'/Viewer/loader/?choice='+pdb_code+'&function=VIEWMOL';

if ($('#'+div_name).is(':checked')){
runCommand('read mol "'+url_string+'" name="'+div_name+'mol"');
runCommand("display a_"+ div_name +"mol. xstick");
runCommand("color a_"+ div_name +"mol.//c* "+colour);


}

else{
runCommand('delete a_'+ div_name +'mol. ');

};


}


var ph4_opt = "Standard";
var loadmymolold = "";
var target_id = {{ target.pk }};
var target_name= '{{ target.title }}';
function loadmymol(){
// javascript function to run when loading molecular images
pdb_code = document.getElementById('pdbin').value;
if(pdb_code == loadmymolold){
// Don't submit the same request twice
  var me=1;
}
else{
// Delete an existing molecule
runCommand('GRAPHICS.l_redraw = no');
runCommand('delete a_.* &! a_act.* &! a_inact.* &! a_shape.* &! a_{{ target.title }}TEMP.* ');
runCommand('GRAPHICS.l_redraw = yes');
runCommand('display new');
// Reset the catch variable
loadmymolold = pdb_code;
// load the macro, wait two seconds for this to finish
var mynewurl = mybase+"{% static "OOMMPPAA/macros.icm" %}";
runCommand('call "'+mynewurl+'"');
// First make a call to see what it is (PDB code, valid smiles or not either -> returns None or PDB code either way)
var url_string = mybase+'/Viewer/loader/?choice='+pdb_code+'&function=CHECKMOL&target={{  target.pk }}';
var me = "";
$.ajax({
  url: url_string,
  beforeSend: function( xhr ) {
    xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
  }
})
  .done(function( data ) {
  // Get the code back
   pdb_code = data;
   if(pdb_code=="None molecule"){
     
     document.getElementById('mynewcanv3-error').style.display="";
   }
   else{
     document.getElementById('mynewcanv3-error').style.display="none";
  // Now make the actual request for the molecule
   var url_string = mybase+'/Viewer/loader/?choice='+pdb_code+'&function=VIEWMOL';
   runCommand('read mol "'+url_string+'"');
   runCommand('display a_.* &! a_act.* &! a_inact.* &! a_shape.* wire');
   // And for the image
   var url_string_new =mybase+'/WONKA/ScoreMol/?target='+target_id+'&code='+pdb_code+'&opt=d'
   filltable(url_string_new,'frag-table');
   var url_string_new =mybase+'/WONKA/ScoreMol/?target='+target_id+'&code='+pdb_code+'&opt=ph4';
   filltable(url_string_new,'ph4-table');
    }
  })
}
};

function show_arom_int(url_1,url_2,code,prot){
 
runCommand('undisplay a_.');

runCommand('read pdb "'+url_1+'"');
runCommand('display a_ cpk');
runCommand('read pdb "'+url_2+'"');
runCommand('display a_ cpk red');
var mol_string = mybase+'/Viewer/loader/?choice='+code+'&function=VIEWMOL';
runCommand('read mol "'+mol_string+'" name="'+code+'mol"');
runCommand('display a_'+code+'mol*.* wire');
var mol_string = mybase+'/Viewer/loader/?choice='+prot+'&function=VIEWPROTEIN';
runCommand('read mol "'+mol_string+'" name="'+prot+'prot"');
runCommand('display a_'+prot+'prot*.* wire');

runCommand('center a_.');
};


function filltable(url_string,div_name){

            $("#"+div_name).tablesorter(); 
$.ajax({
  url: url_string,
  beforeSend: function( xhr ) {
    xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
  }
})
  .done(function( data ) {
  response = $.parseJSON(data);
  $(function() {
    $.each(response, function(i, item) {
        var my_score = item.score.toFixed(2);
        $('<tr>').append(
            
            $('<td>').text(my_score),
            $('<td>').text(item.type)
        ).appendTo('#'+div_name);

        
    });
  });  
  
  
  
  })

}


function updateMap(){
// function to update the activiy maps

var myMaps=new Array();
var myPks =new Array();
runCommand('deleteObjs "star" Atom(a_act.)');
runCommand('deleteObjs "cube" Atom(a_inact.)');
runCommand('deleteObjs "doublepyramid" Atom(a_non.)');
{% for map in maps %}
myMaps[{{ forloop.counter0 }}] = '{{map.Type}}'
myPks[{{ forloop.counter0 }}] = {{ map.pk }}
{% endfor %}

for (var i=0;i<myMaps.length;i++)
	{
	if ($('#choice'+myMaps[i]+'blah').is(':checked'))
		{
		loadpdblight(myMaps[i],myPks[i])
		};
	};
};

function maxAct(log){
           if (log==0){  
           var ht = String($(window).height()*0.8)+"px"
           document.getElementById('act-container').style.height=ht;
           document.getElementById('maxactbutt').style.display="none";
           document.getElementById('minactbutt').style.display="";
           }
           else if(log==1){
           document.getElementById('act-container').style.height="";
           document.getElementById('maxactbutt').style.display="";
           document.getElementById('minactbutt').style.display="none";
           }
};

function maxICM(log){

// Function to control the size of the ICM window. Should go in ICM_funs.js eventually
    		// undisplay all the divs
    		
    		var mydivs = new Array('ICM','maps','sliders','act','im','im2');

    		
			if(log==0){    		
    		for (var i = 1; i < mydivs.length; i++) {
    		  document.getElementById(mydivs[i]+'-container').style.display='none';
			}
			document.getElementById('ICM-box').setAttribute("class","col-lg-12");
			var wt = String($(window).width())+"px"
			var ht = String($(window).height()*0.8)+"px"
            document.getElementById('ActiveIcmCtl').style.height=ht;
            document.getElementById('ActiveIcmCtl').style.width=wt;
            document.getElementById('tot-container').style.marginLeft="20px";
            document.getElementById('tot-container').style.marginRight="20px";
            //.margin-left="10px";
            document.getElementById('minbutt').style.display="";
            document.getElementById('maxbutt').style.display="none";
            document.getElementById('mmpdispbutt').style.display="";
            document.getElementById('mmprembutt').style.display="";
            document.getElementById('ICM-png').style.display="none";
            var ht = String($(window).height()*0.8)+"px"
			var wt = String($(window).width()*0.3)+"px"        
            
            }
            else if(log==1)
            {
    		for (var i = 1; i < mydivs.length; i++) {
    		  document.getElementById(mydivs[i]+'-container').style.display='';
			}
			document.getElementById('ICM-png').style.display="";
			document.getElementById('ICM-box').setAttribute("class","col-lg-6");
            document.getElementById('ActiveIcmCtl').style.height='450px';
            document.getElementById('ActiveIcmCtl').style.width='100%';
            document.getElementById('tot-container').style.marginLeft="";
            document.getElementById('tot-container').style.marginRight="";
            document.getElementById('minbutt').style.display="none";
            document.getElementById('maxbutt').style.display="";   
            document.getElementById('mmpdispbutt').style.display="none";
            document.getElementById('mmprembutt').style.display="none";        
            
            }
};
var ht = String($(window).height()*0.8)+"px"
			


function  letsshape2(shape){
// function to put  shapes into the ICM viewer
	var myurl = mybase+"{% static "OOMMPPAA/shapes.icb" %}"
	runCommand('read binary "'+myurl+'" name="'+shape+'"')
	runCommand('undisplay '+shape)
};

    
window.onload = function()
                {
                

 	// load the macro
	var mynewurl = mybase+"{% static "OOMMPPAA/macros.icm" %}";
    runCommand('call "'+mynewurl+'"');
	var mynewurl = mybase+"{% static "OOMMPPAA/macros.icm" %}";
	runCommand('call "'+mynewurl+'"');
	// Now load in the shapes
	var myurl = mybase+"{% static "OOMMPPAA/shapes.icb" %}"
	letsshape2('star');
	letsshape2('cube');
};
 $(function(){
    $("[data-hide]").on("click", function(){
        $("." + $(this).attr("data-hide")).hide();
        // -or-, see below
        // $(this).closest("." + $(this).attr("data-hide")).hide();
    });
});
var orig_body = "";
$(function () { $("[data-toggle='tooltip']").tooltip(); }); 
var spinner = '{% static "OOMMPPAA/spinner.gif" %}'
    	$(document).ready(function() {
            $('.btn').button()
            var spinurl = mybase+spinner;
            var img = document.createElement("IMG");
            img.src = spinurl;     		
	    	/* Make sliders */
	        $("#confs").slider({});
	        $("#conserved").slider({});
	        $("#pharma").slider({});
	        $("#redgraph").slider({});
	        setTimeout(function(){
	        // Load the protein
	        //loadmyprot('{{ target.title }}TEMP')
	        // Now set the view
	        //runCommand('display a_*TEMP. ribbon');
	        // Load in any ligand for this target and centre on this ligand
            var mol_string = mybase+'/Viewer/loader/?choice={{ target.mol }}&function=VIEWMOL';
            $('#key-water-button').click();
            $('#MOL{{tot_mols.1.pk}}').click();
			runCommand("center static");
            click_prot(event,'{{tot_mols.1.pk}}','{{ tot_mols.1.code}}');
            
            var body = document.getElementsByTagName("body");
			var bodycontent = body[0];
			orig_body = bodycontent.innerHTML;
	        },2000)
    	});
    	
$(document).keypress(function(event) {
	
    var keycode = (event.keyCode ? event.keyCode : event.which);
    if (keycode == '13') {
        event.preventDefault();
        $('#searchbutt').click();
    }
});



function show_res(res_name,div_name,my_colour){

   if ($('#'+div_name).is(':checked')){
   
   runCommand('display a_./'+res_name+' cpk');
   runCommand('color a_.//c* & a_./'+res_name+' '+my_colour);
   
   }
   
   else{
   runCommand('color a_.//c* & a_./'+res_name+' white');
   runCommand('display a_./'+res_name+' xstick');
   runCommand('undisplay a_./'+res_name+' cpk');   
   }


};


function centre_res(res_name){


   runCommand('center a_./'+res_name);



};


function re_select_data(){
	runCommand('delete my_var');
	runCommand('my_var = String(Box())');
	var my_var = getVar('my_var').replace(/ /g,'');
	url_string = mybase+'/WONKA/{{  target.pk  }}/Summarise/?map='+my_var;
	window.open(url_string, '_blank');
}
function show_mol_prot(url,div_name,my_colour){

   if ($('#'+div_name).is(':checked')){
var my_s = 'read pdb "'+url+'" name="'+div_name+'"';

runCommand(my_s);
runCommand('display a_'+div_name+'. cpk');
runCommand('display a_'+div_name+'. xstick');
runCommand('color a_'+div_name+'. '+my_colour);
}

else{
       runCommand('delete a_'+div_name+'*. ');
      };
}


function show_mol_frags(pdb_code){
var url_string =mybase+'/WONKA/ScoreMol/?target={{  target.pk }}&code='+pdb_code+'&opt=frag'
$.ajax({
  url: url_string,
  beforeSend: function( xhr ) {
    xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
  }
}).done(function(data){
  
    response = $.parseJSON(data);
  
  
  $(function() {
   var HTML_out = "";
    $.each(response, function(i, item) {
        var my_score = item.score.toFixed(2);

            
            HTML_out += '<img src="/Viewer/loader/?function=2DMOL&choice='+item.type+'" style="width:40%"></img>'


        
    });
    
    
    $('#ph4-container').innerHTML = HTML_out;
  
 
  
  })
})
};




function fill_in(mol_pk,my_colour,counter){
var counter = parseInt(counter) 
var my_canvas = "MOL"+mol_pk+"CAN";
var c = document.getElementById(my_canvas);
var ctx = c.getContext("2d");
var start_x = counter*10;
var end_x = (counter+1)*10;
ctx.beginPath();
ctx.moveTo(start_x,0);
ctx.lineTo(end_x,0);
ctx.strokeStyle=my_colour;
ctx.lineWidth=10;
ctx.stroke();
}

function clear_canv(mol_pk){
var my_canvas = "MOL"+mol_pk+"CAN";
var c = document.getElementById(my_canvas);
var ctx = c.getContext("2d");
ctx.beginPath();
ctx.moveTo(0,0);
ctx.lineTo(50,0);
ctx.strokeStyle="white";
ctx.lineWidth=10;
ctx.stroke();
}


function draw_text(mol_pk,text,i){
var my_canvas = "MOL"+mol_pk+"CAN";
var c = document.getElementById(my_canvas);
var ctx = c.getContext("2d");
ctx.font="20px Georgia";
var start_pos = 50+(i*10)
ctx.fillText(text,start_pos,0);
}


function show_one(div_name, class_name, show_class, json_key){
var my_class = '.'+class_name;
var my_div = '#'+div_name+"-div"

var class_div = $(my_class);
var all_but_one = $(my_class).not(my_div);

$(my_class).show();

$(my_class).not(my_div).hide();

$(".top-show").each(function(){

// Uncheck everything
if ($(this).is(':checked')){
    $(this).click();
    $(this).click().attr('checked', false);
    }
});



// Check what we want to check
$("."+show_class).each(function(){
    $(this).click();
    $(this).click().attr('checked', true);
});

// First blank the canvas for all of them
var my_mols = tot_data["all_mols"];
for (var mol in my_mols){
   clear_canv(my_mols[mol])

};
// Now get the ones we want to colour
var my_json = tot_data[json_key];
var counter = -1;
for (var key in my_json) {
    counter +=1;
    if (my_json.hasOwnProperty(key)) { // check if the key exists
    var my_l = key.split("_")
    my_colour =my_l[0]
    my_counter = my_l[1]
    for(var num in my_json[key]){
        fill_in( my_json[key][num],my_colour,my_counter); // now colour all these with this colour
        }
    }
}


};


function highlight_mols(highlight_feat, pos_neg, highlight_colour){
// First make an ajax call to get the list of appropriate molecule pks
var mol_string = mybase+'/WONKA/loader/?choice='+code+'&function=VIEWMOL';
}


// Global variable to store pks
var mol_pks = [];
var prot_pks = [];

function undisplay_all(arg){
var tmp_pks = [];

if(arg=="MOL"){
my_pks = mol_pks;
}

if(arg=="PROT"){
my_pks = prot_pks;
}

while (mol_pks.length > 0) {
    var my_s = "#MOL"+my_pks[0].toString()
    //Do something
    $(my_s).click();
}


}


function click_mol(my_pk, code){



var my_div = "MOL"+my_pk

if (document.getElementById(my_div).style.opacity == 1.0){



var index = mol_pks.indexOf(my_pk);
if (index > -1) {
    mol_pks.splice(index, 1);
}

//
$("."+my_div).removeClass("btn-on").addClass( "btn-off" );


document.getElementById(my_div).style.opacity = 0.5;
runCommand('delete a_'+code+'mol*.*');
}
else{

$("."+my_div).removeClass("btn-off").addClass( "btn-on" );
mol_pks.push(my_pk)

document.getElementById(my_div).style.opacity = 1.0;
fill_in(my_pk,"grey","8");
var mol_string = mybase+'/Viewer/loader/?choice='+code+'&function=VIEWMOL';
runCommand('read mol "'+mol_string+'" name="'+code+'mol"');
runCommand('display a_'+code+'mol*.* wire');
runCommand('color a_'+code+'mol*./*/c* grey');

}
}


function click_prot(event, my_pk, code, opt){


var my_div = "MOL"+my_pk
// If it is on
if (document.getElementById(my_div+"BL").className.indexOf(opt+"Class") > -1){

var re = new RegExp(opt+"Class", "g");
document.getElementById(my_div+"BL").className = document.getElementById(my_div+"BL").className.replace(re,'')

var index = prot_pks.indexOf(my_pk);
if (index > -1) {
    mol_pks.splice(index, 1);
}


runCommand('delete a_'+code+'prot*.*');
}
else{
document.getElementById(my_div+"BL").className += " protClass";
fill_in(my_pk,"black","6");
var prot_string = mybase+'/Viewer/loader/?choice='+code+'&function=VIEWPROTEIN';
runCommand('read pdb "'+prot_string+'" name="'+code+'prot"');
runCommand('display a_'+code+'prot*.* 5 ribbon');
runCommand('display Res(Sphere(a_*.m  a_'+code+'prot*.* 5)) xstick');
runCommand('color a_'+code+'prot*./*/c* grey');
prot_pks.push(my_pk)
}
}




function click_mol_handler(event, my_pk, code){





var my_div = "MOL"+my_pk

if(event.shiftKey == undefined)
{
click_mol(my_pk, code, "M");
return
}

if (event.ctrlKey == false && event.shiftKey == false && event.altKey == false){ 
// Click the molecule
click_mol(my_pk, code, "M");


}


if (event.ctrlKey == true && event.shiftKey ==true && event.altKey == true){ 
show_interactions(my_pk)
}

if (event.ctrlKey == false && event.shiftKey == true && event.altKey == false){ 


////click_waters(my_pk, code, mol_pk, "W")
var water_string = mybase+'/Viewer/loader/?choice='+code+'&function=VIEWWATER';

if (document.getElementById(my_div+"BL").className.indexOf("waterClass") > -1){
document.getElementById(my_div+"BL").className = document.getElementById(my_div+"BL").className.replace(/(?:^|\s)waterClass(?!\S)/g ,'')
runCommand('delete a_'+code+'water*.*');
}
else{
document.getElementById(my_div+"BL").className += " waterClass";
runCommand('read mol "'+water_string+'" name="'+code+'water"');
runCommand('display a_'+code+'water*.* xstick');
}
}


if (event.ctrlKey == true && event.shiftKey == false && event.altKey == false) { 
click_prot(event, my_pk, code, "prot")
}


if (event.ctrlKey == true && event.altKey == true && event.shiftKey == false) { 
//click_mol_ph4(my_pk, code, mol_pk, "4")
if (document.getElementById(my_div+"BL").className.indexOf("surfClass") > -1){
document.getElementById(my_div+"BL").className = document.getElementById(my_div+"BL").className.replace(/(?:^|\s)surfClass(?!\S)/g ,'')
runCommand('undisplay a_'+code+'prot*.* skin');
}
else{
document.getElementById(my_div+"BL").className += " surfClass";

runCommand('display a_'+code+'prot*.* skin');
}

}

if (event.ctrlKey == true && event.shiftKey == true && event.altKey == false) {

if (document.getElementById(my_div+"BL").className.indexOf("ph4Class") > -1){
document.getElementById(my_div+"BL").className = document.getElementById(my_div+"BL").className.replace(/(?:^|\s)ph4Class(?!\S)/g ,'')

runCommand('delete a_'+code+'pharma.');
runCommand('display a_'+code+'mol. wire');

}

else{
document.getElementById(my_div+"BL").className += " ph4Class";
var url_string_new =mybase+'/WONKA/ScoreMol/?target={{  target.pk }}&code='+code+'&opt=out'
runCommand('read pdb "'+url_string_new+'" name="'+code+'pharma"');
runCommand('display a_'+code+'pharma. xstick');
runCommand('display a_'+code+'mol. wire');
runCommand('color Atom(a_'+code+'pharma.) Bfactor(Atom(a_'+code+'pharma.))');
}

}

if (event.ctrlKey == true && event.shiftKey == true && event.altKey == false) { 

        var link = mybase+"{% url 'WONKA:get_grob' target.id %}";
        link=link.replace('/{{target.id}}/', '/'+my_pk+'/');
        var my_s = "read grob '"+link+"' name='my_g'";
        runCommand(my_s)
        runCommand("display my_g")
}

}






var tot_data = {{ tot_list|safe }};


function david_hacker(){

runCommand('write binary')
};


function generateSetStringCommand(varName, value, file_name) {
    var varLen = value.length;
    var blockSize = 3000;
    var setCode = "";
    if(varLen < blockSize) {
    var my_s = varName + " = '" + value + "'";
    runCommand(varName + " = '" + value + "'");
    runCommand('write string '+varName+" '"+file_name+"'");
    }
    else {
        var done = blockSize;
        // Change these to JQUERY - AND MAKE ARRAY / RUNCOMMAND HERE
        runCommand(varName + " = ''");
        setCode = varName + " = " + varName + " + '" + value.substring(0, done+blockSize) + "'";
        runCommand(setCode);
        while(done < varLen) {
            // APPEND ARRAY HERE / RUNCOMMAND HERE
            setCode = varName + " = " + varName + " + '" + value.substring(done, done+blockSize) + "'";
            runCommand(setCode);
            done = done + blockSize;
        }
        runCommand("db_q = '"+'"'+"'");
       runCommand('sing_q = "'+"'"+'"');
       runCommand('my_file = Replace(my_file "<DOUBLE>" db_q)');
       runCommand('my_file = Replace(my_file "<SINGLE>" sing_q)');
       runCommand('my_file = Replace(my_file "</PA>" ")")');
       runCommand('my_file = Replace(my_file "<PA>" "(")');
       var my_s = 'my_file = Replace(my_file "<NEWLINE>" "\\n")';
       runCommand(my_s);
       var my_s = 'write string '+varName+" '"+file_name+"'";
       runCommand(my_s);
        return 1;
    }
}

var spin_opts = {
  lines: 13, // The number of lines to draw
  length: 20, // The length of each line
  width: 10, // The line thickness
  radius: 30, // The radius of the inner circle
  corners: 1, // Corner roundness (0..1)
  rotate: 0, // The rotation offset
  direction: 1, // 1: clockwise, -1: counterclockwise
  color: '#000', // #rgb or #rrggbb or array of colors
  speed: 1, // Rounds per second
  trail: 60, // Afterglow percentage
  shadow: false, // Whether to render a shadow
  hwaccel: false, // Whether to use hardware acceleration
  className: 'spinner', // The CSS class to assign to the spinner
  zIndex: 2e9, // The z-index (defaults to 2000000000)
  top: '50%', // Top position relative to parent
  left: '50%' // Left position relative to parent
};


function b64toBlob(b64Data, contentType, sliceSize) {
    contentType = contentType || '';
    sliceSize = sliceSize || 512;

    var byteCharacters = atob(b64Data);
    var byteArrays = [];

    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
        var slice = byteCharacters.slice(offset, offset + sliceSize);

        var byteNumbers = new Array(slice.length);
        for (var i = 0; i < slice.length; i++) {
            byteNumbers[i] = slice.charCodeAt(i);
        }

        var byteArray = new Uint8Array(byteNumbers);

        byteArrays.push(byteArray);
    }

    var blob = new Blob(byteArrays, {type: contentType});
    return blob;
}

function download_state(){

// Now save this to the file system
var my_var = $.parseJSON(getVar('s_tempDir'));
var tmp = my_var['s_tempDir'];
// Now save the ICB to the database - to the same object
var file_name ="ME";
runCommand("write binary all preview s_tempDir+'/temp.icb'");
runCommand("read blob s_tempDir+'/temp.icb' name='BLOB'");
runCommand("out_blob = String(BLOB 'base64')");
var ctl = this.document.getElementById('ActiveIcmCtl');
var my_var = ctl.GetShellVar('out_blob');
var my_j = $.parseJSON(my_var);
blob = b64toBlob(my_j["out_blob"], "application/octet-binary", 512)
saveAs(blob ,"me.icb")
runCommand("delete BLOB");

}

function save_state(){
var body = document.getElementsByTagName("body");
var bodycontent = body[0];
// Now save this to the database - currently with a random name
var my_var = $.parseJSON(getVar('s_tempDir'));
var tmp = my_var['s_tempDir'];
// Now save the ICB to the database - to the same object
var file_name ="ME";
runCommand("write binary all preview s_tempDir+'/temp.icb'");
runCommand("read blob s_tempDir+'/temp.icb' name='BLOB'");
runCommand("out_blob = String(BLOB 'base64')");
var ctl = this.document.getElementById('ActiveIcmCtl');
var my_var = ctl.GetShellVar('out_blob');
var my_j = $.parseJSON(my_var);
runCommand("delete BLOB");
my_j["my_html"] = bodycontent.innerHTML;
my_j["csrfmiddlewaretoken"] = "{{ csrf_token }}"
my_j["user"] = {{ user.pk }}
my_j["comments"] = document.getElementById('inputComments').value
my_j["target"] = {{ target.pk }}
var URL = "{% url 'WONKA:register_observation' %}";
var spinner = new Spinner(spin_opts).spin(document.getElementById("LOGIN"));
    $.post(URL, my_j, function(response){
        if(response == 'FAIL!'){ 
        alert('Error! :(');
        
        }
        
        else{ 
		// Put in the target id as a a blank
        var link = "{% url 'WONKA:ShowObs' target.id %}";
        // The nreplace with response
        link=mybase+link.replace('/{{target.id}}/', '/'+response+'/');
        document.getElementById("out_link").innerHTML = "<h4>This is the link: <a target='_blank' href='" + link + "'>Click me to see your observation</a></h4>"
        }
        spinner.stop();
    });
}



function register(){
  
var my_j = {}
my_j["FirstName"] = document.getElementById('inputFirstName').value
my_j["LastName"] = document.getElementById('inputLastName').value
my_j["EMail"] = document.getElementById('inputEMail').value
my_j["csrfmiddlewaretoken"] = "{{ csrf_token }}"
if(document.getElementById('inputPassword').value==document.getElementById('inputConfPassword').value){

my_j["Password"] = document.getElementById('inputPassword').value
}
else{
alert("Passwords don't match!");
return
}


var URL = "{% url 'WONKA:register_user' %}";
var spinner = new Spinner(spin_opts).spin(document.getElementById("LOGIN"));
    $.post(URL, my_j, function(response){
alert(response);
spinner.stop();
		location.reload();

 });
  
  }
  
function login(){
  
var my_j = {}
my_j["EMail"] = document.getElementById('inputEMailLOG').value
my_j["csrfmiddlewaretoken"] = "{{ csrf_token }}"
my_j["Password"] = document.getElementById('inputPasswordLOG').value



var URL = "{% url 'WONKA:login_user' %}";
var spinner = new Spinner(spin_opts).spin(document.getElementById("LOGIN"));
    $.post(URL, my_j, function(response){
alert(response);
spinner.stop();
		location.reload();

 });
  
  }
  
  
function show_interactions(mol_pk){
//Function to show the interactions between a molecule and a protein
runCommand("delete a_url*.")

//Load the interactions involving this molecule
url_string = "{% url 'WONKA:get_interactions' %}?obs_id="+mol_pk+"&dist=7.5";

$.ajax({
  url: url_string,
  beforeSend: function( xhr ) {
    xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
  }
}).done(function(data){
  
    my_j = $.parseJSON(data);
   	for (var i = 0; i < my_j.length; i++) { 
	// Load them
	runCommand("read pdb '"+my_j[i]["url_1"]+"'");
	runCommand("display a_ xstick red");
	runCommand("me = a_");
	runCommand("read pdb '"+my_j[i]["url_2"]+"'");
	runCommand("display a_ xstick blue");
	runCommand("you = a_");

;	// Show them
	runCommand("make distance me you");
	if (i==0){
	runCommand("display distpairs");
	}
	else{
	runCommand("display distpairs_"+i.toString());
	}
	
	}
	
	
	})
	

};
</script>
  
  
  
  
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="{% url 'WONKA:index'%}" class="navbar-brand">WONKA</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="targets">Targets <span class="caret"></span></a>
              <ul class="dropdown-menu" aria-labelledby="themes">
			    {% if targets %}
			      {% for Target in targets %}
			        <li><a tabindex="-1"href="{% url 'WONKA:Summarise' Target.id %}">{{ Target.title }}</a></li>
			      {% endfor %}
			    {% else %}
			    <li><a tabindex="-1" >No targets are available.Make your first?</a></li>
			    {% endif %}
              </ul>
            </li>
            <li>
              <a href="http://www.blopig.com/blog/">Blog</a>
            </li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="download">Download<span class="caret"></span></a>
                <ul class="dropdown-menu" aria-labelledby="themes">
			       <li><a tabindex="-1"href="https://bitbucket.org/abradley/dist/Windows">Windows</a></li>
			       <li class="divider"></li>
			       <li><a tabindex="-1"href="https://bitbucket.org/abradley/dist/Ubuntu">Ubuntu</a></li>
			       <li><a tabindex="-1"href="https://bitbucket.org/abradley/dist/Centos">Centos</a></li>
			       <li class="divider"></li>
			       <li><a tabindex="-1"href="https://bitbucket.org/abradley/src">Python</a></li>
			    </ul>
            </li>
          </ul>
          <form class="navbar-form navbar-left">
            <input id="pdbin" type="text" class="form-control col-lg-8" placeholder="Input SMILES or code">
          </form>
          <ul class="nav navbar-nav">
            <li>
              <a  id="searchbutt" 
              class="btn btn-sm btn-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Search for this PDB id or SMILES" onclick="loadmymol();">Search</a>
            </li>
                        <li>
              <a href="{% url 'index' %}">HOME</a>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-left">
            <li><a>{{ target.title }}</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://builtwithbootstrap.com/" target="_blank">Built With Bootstrap</a></li>
          </ul>
        </div>
      </div>
    </div>
<div id="tot-container" class="container-fluid">

   <div class="row">

	<div id="first-div" style="height:800px;"class="col-lg-3 well-sm">  
    <div style="height:70px">
       <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="options" id="key-ph4-button" onchange="show_one('key-ph4','viewer-one','ph4-show','key_ph4')" onclick="show_one('key-ph4','viewer-one','ph4-show')"> Key Ph4
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="options" id="wie-feat-button" onchange="show_one('wie-feat','viewer-one','wie-show','wie_feat')" >Rare Ph4
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="options" id="key-frag-button" onchange="show_one('key-frag','viewer-one','frag-show','key_frag')">Key Motif
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="options" id="key-res-button" onchange="show_one('max-res','viewer-one','res-show','max_shift')">Key Res
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="options" id="key-water-button" onchange="show_one('key-water','viewer-one','water-show','key_waters')">Key H20
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="options" id="key-ring-button" onchange="show_one('key-ring','viewer-one','ring-show','key_rings')">Key Ring
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="options" id="key-ring-button" onchange="show_one('mol-clusts','viewer-one','clust-show','mol_clusts')">Sites
          </label>
          
        </div>
	</div>
	<div style="overflow-x:scroll;height:300px">

	<div class="viewer-one"  style="display:none" id="key-frag-div">
	<h3>Key Motifs</h3>
	<p> <b>left click:</b> toggle display</p>
	{% for mol in key_frag %}
	<div class="row"  style="margin-top:5px;">
	    <div class="col-lg-5" style="border-width:medium; border-color:{{ mol.bg }}">
				  <div  style="display:inline-block;margin-top:0px;margin-bottom:0px" class="checkbox">
	                <label class="btn-sm" style="width: 160px;color:white;background-color:{{ mol.bg }}">{{mol.myname}} :  {{ mol.num }} %
	                <input  style="display:none" type="checkbox" class="frag-show top-show" id="choice{{mol.pk}}key_frag1"; value="{{ mol.pk }}" onclick="show_mol_prot('{{mol.url_centre}}','choice{{mol.pk}}key_frag1','{{ mol.button }}')">
	                </label>
	              </div>
	    </div>  
	    <div class="col-lg-7 ">  
	            <div class="btn-group btn-group-justified btn-group-fill-height">
	      	{% for item in tot_mols %}
				{% if item.pk in mol.my_list %}
	         		<a class="btn btn-xs btn-success MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% else %}
				    <a class="btn btn-xs btn-default MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% endif %}
			{% endfor %}    
				</div>
	    </div>
	                        
	</div>
	{% endfor %}
	</div>
 


	<div class="viewer-one"  style="display:none" id="mol-clusts-div">
	<h3>Sites</h3>
	<p> <b>left click:</b> toggle display</p>
	{% for mol in mol_clusts %}
	<div class="row"  style="margin-top:5px;">
	    <div class="col-lg-5" style="border-width:medium; border-color:{{ mol.bg }}">
				  <div  style="display:inline-block;margin-top:0px;margin-bottom:0px" class="checkbox">
	                <label class="btn-sm" style="width: 160px;color:white;background-color:{{ mol.bg }}">{{mol.size}}
	                <input  style="display:none" type="checkbox" class="clust-show top-show" id="choice{{mol.pk}}key_site"; value="{{ mol.pk }}" onclick="show_mol_prot('{{mol.url_centre}}','choice{{mol.pk}}key_site','{{ mol.button }}')">
	                </label>
	              </div>
	    </div>  
	    <div class="col-lg-7 ">  
	            <div class="btn-group btn-group-justified btn-group-fill-height">
	      	{% for item in tot_mols %}
				{% if item.pk in mol.my_list %}
	         		<a class="btn btn-xs btn-success MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% else %}
				    <a class="btn btn-xs btn-default MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% endif %}
			{% endfor %}    
				</div>
	    </div>
	                        
	</div>
	{% endfor %}
	</div>
 
 
 
<div class="viewer-one"  style="display:none" id="key-ring-div">
	<h3>Key Rings</h3>
	<p> <b>left click:</b> toggle display</p>
	{% for mol in key_rings %}
	<div class="row"  style="margin-top:5px;">
	    <div class="col-lg-5"  style="border-width:medium; border-color:{{ mol.bg }}">
	              
			<div  style="display:inline-block;margin-top:0px;margin-bottom:0px" class="checkbox">
	                <label class="btn-sm" style="width: 160px;color:white;background-color:{{ mol.bg }}">{{mol.myname}} :  {{ mol.size }}
	                <input  style="display:none" type="checkbox" class="ring-show top-show" id="choice{{mol.pk}}key_ring1"; value="{{ mol.pk }}" onclick="show_mol_prot('{{mol.url_centre}}','choice{{mol.pk}}key_ring1','{{ mol.button }}')">
	                </label>
	         </div>
	    </div>
	    <div class="col-lg-7 ">  
	       <div class="btn-group btn-group-justified btn-group-fill-height">
	       	{% for item in tot_mols %}
				{% if item.pk in mol.my_list %}
	         		<a class="btn btn-xs btn-success MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% else %}
				    <a class="btn btn-xs btn-default MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% endif %}
			{% endfor %}    
	        </div>     
	     </div>         
	</div>
	{% endfor %}
</div>




              
<div class="viewer-one"  style="display:none" id="key-water-div">
	<h3>Key Waters</h3>
	<p> <b>left click:</b> toggle display</p>
	<div  class="row">
	<p class="col-lg-6"></p>

	<img src="{% static "WONKA/key.png" %}"></img>
	</div>
	{% for mol in key_waters %}
	<div  class="row" style="margin-top:5px;">
	    <div class="col-lg-5" style="border-width:medium; border-color:{{ mol.bg }}">
				  <div  style="display:inline-block;margin-top:0px;margin-bottom:0px" class="checkbox">
	                <label class="btn-sm" style="width: 160px;color:white;background-color:{{ mol.bg }}"> Conserved water ({{ mol.size }}) 
	                <input  style="display:none" type="checkbox" class="water-show top-show" id="choice{{mol.pk}}key_water"; value="{{ mol.pk }}" onclick="show_mol_prot('{{mol.url_centre}}','choice{{mol.pk}}key_water','{{ mol.button }}')">
	                </label>
	              </div>
	    </div>
	    <div class="col-lg-7 ">
	            <div class="btn-group btn-group-justified btn-group-fill-height">
	      	{% for item in tot_mols %}
				{% if item.pk in mol.my_list %}
	         		<a class="btn btn-xs btn-default MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% else %}
				    <a class="btn btn-xs btn-success MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% endif %}
			{% endfor %}                      
			    </div>
	 	</div>
	 </div>
	{% endfor %}
</div>
              
 
 
 
<div class="viewer-one" style="display:none" id="key-ph4-div">

	<h3>Key PH4s</h3>
	<p> <b>left click:</b> toggle display</p>
	<div  class="row">
	<p class="col-lg-6"></p>

	<img src="{% static "WONKA/key.png" %}"></img>
	</div>
	{% for mol in key_ph4 %}
	<div class="row"  style="margin-top:5px;">
	    <div class="col-lg-5"  style="border-width:medium; border-color:{{ mol.bg }}">
				  <div  style="display:inline-block;margin-top:0px;margin-bottom:0px" class="checkbox">
	                <label class="btn-sm" style="width: 160px;color:white;background-color:{{ mol.bg }}">{{ mol.smiles }} :  {{ mol.num }} %
	                <input  style="display:none" type="checkbox" class="ph4-show top-show" id="choice{{mol.pk}}ph4"; value="{{ mol.pk }}" onclick="show_mol_prot('{{mol.url_centre}}','choice{{mol.pk}}ph4','{{ mol.button }}')">
	                </label>
	              </div>
	     </div>
	     <div class="col-lg-7 ">
	          <div class="btn-group btn-group-justified btn-group-fill-height">
	      	{% for item in tot_mols %}
				{% if item.pk in mol.my_list %}
	         		<a class="btn btn-xs btn-success MOL{{item.pk}} btn-off" style="height:27px" onclick="$('#MOL{{item.pk}}').click()"></a>
				{% else %}
				    <a class="btn btn-xs btn-default MOL{{item.pk}} btn-off" style="height:27px"  onclick="$('#MOL{{item.pk}}').click()"></a>
				{% endif %}
			{% endfor %}    
	             </div>       
	     </div>         
    </div>
	{% endfor %}
</div>


<div class="viewer-one" style="display:none" id="max-res-div">

<h3>Large residue shifts</h3>
<p> <b>left click:</b> toggle display</p>

{% for mol in max_shift %}
	<div class="row"  style="margin-top:5px;">
	    	  <div  class="col-lg-4" style="display:inline-block;margin-top:0px;margin-bottom:0px" class="checkbox">
                <label class="btn-sm" style="width: 152px;color:white;background-color:{{ mol.bg }}">{{ mol.res }} :  {{ mol.shift|floatformat:3 }} RMSD
                <input  style="display:none;" type="checkbox" class="res-show top-show" id="choice{{ forloop.counter }}res"; value="{{ mol.pk }}" onclick="show_res('{{mol.res}}','choice{{ forloop.counter }}res','{{mol.button}}')">
                </label>
              </div>
        <a onclick="centre_res('{{ mol.res }}')" class="col-lg-2 btn btn-sm btn-info" >Centre</a>
      	<div class="col-lg-6 ">
	          <div class="btn-group btn-group-justified btn-group-fill-height">
	      	{% for item in mol.my_list %}
	         		<a class="btn btn-xs" style="background:{{ item.colour }}; border-color:#484857; height:27px" onclick="$('#MOL{{item.pk}}').click()"></a>
			{% endfor %}    
	             </div>       
	     </div>  
</div>
{% endfor %}
       </div>
    
  

       
       
       

     
<div class="viewer-one" style="display:none" id="wie-feat-div">
	<h3>Rare Ph4s</h3>
	<p> <b>left click:</b> toggle display</p>
	<div  class="row">
		<p class="col-lg-6"></p>
		<img src="{% static "WONKA/key.png" %}"></img>
	</div>
	{% for mol in wie_feat %}
    <div class="row"  style="margin-top:5px;">
    	<div class="col-lg-5"  style="border-width:medium; border-color:{{ mol.bg }}">              
			  <div  style="display:inline-block;margin-top:0px;margin-bottom:0px;" class="checkbox">
                <label class="btn-sm" style="width: 160px;color:white;background-color:{{ mol.bg }}">{{ mol.smiles }}
                <input  style="display:none" type="checkbox" class="wie-show top-show" id="choice{{mol.pk}}wie_feat1"; value="{{ mol.pk }}" onclick="show_mol_prot('{{mol.url_centre}}','choice{{mol.pk}}wie_feat1','{{ mol.button }}')">
                </label>
              </div>
         </div>
	     <div class="col-lg-7 ">
	          <div class="btn-group btn-group-justified btn-group-fill-height">
	      	{% for item in tot_mols %}
				{% if item.pk in mol.my_list %}
	         		<a class="btn btn-xs btn-success MOL{{item.pk}} btn-off" style="height:27px" onclick="$('#MOL{{item.pk}}').click()"></a>
				{% else %}
				    <a class="btn btn-xs btn-default MOL{{item.pk}} btn-off" style="height:27px" onclick="$('#MOL{{item.pk}}').click()"></a>
				{% endif %}
			{% endfor %}    
	             </div>       
	     </div>  
     </div>
	{% endfor %}
</div>
       
       
       
       
	
</div>	 
	
	<div id="mol-container">
         <h3>Molecules:</h3> 
         <p> <b>left-click:</b> show moleclule ||<b>  ctrl+left-click:</b> show protein </p>
         <p> <b>shift+left-click:</b> show water || <b>  ctrl+alt+left-click:</b> toggle surface</p>
         <a id="unds_all_but" onclick="undisplay_all('MOL');" class="btn btn-sm btn-success">Undisplay Ligs</a>
         <a id="unds_int_but" onclick="runCommand('delete a_url*.');" class="btn btn-sm btn-success">Undisplay Ints</a>

		<div  style="overflow-y:scroll;height:550px;">
     	{% for mol in tot_mols %}
     	    {% if mol.acts %}
		 	<a data-toggle="tooltip" data-placement="top" title="{{mol.my_id}}: {{ mol.acts|floatformat }}" class="container" style="cursor:pointer"  id="MOL{{mol.pk}}BL">
		 	{% else %}
		   <a data-toggle="tooltip" data-placement="top" title="{{mol.my_id}}" class="container" style="cursor:pointer"  id="MOL{{mol.pk}}BL">
			{% endif %}
		 	  <canvas width="50px" height="5px" id="MOL{{mol.pk}}CAN" class="coveringCanvas"></canvas>
		 	  <img class="img_class" src={{mol.src}}  id="MOL{{mol.pk}}" type="checkbox" value="{{ mol.pk }}" onclick="fill_in({{mol.pk}});click_mol_handler(event,'{{mol.pk}}','{{ mol.code}}')"  style="opacity:0.5;border-style:dash;width:100%"></img>
			</a>
		{% endfor %}
        </div>         
    </div>	
	</div>
	
	<div id="ICM-box" style="margin-top:20px;" class="col-lg-9">
	  <div id="ICM-container">
	  <object type="application/x-molsoft-icb" style="width: 100%; height:850px; margin: 0 !important;" id="ActiveIcmCtl">
	  <param value="{% static "Viewer/overview.icb" %}" name="targetFile">
	  <param value="windowed" name="wmode">
	</object>
	<p></p>
	<a data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Gives ICM a brutal black background" class="btn btn-sm btn-default" onclick="runCommand('color background rgb={0,0,0}');">Dark display</a>
    <a data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Gives ICM a shiny white background" class="btn btn-sm btn-default" onclick="runCommand('color background rgb={255,255,255}');">White display</a>
	<a data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Show the compounds from the selected points" id="mmpdispbutt" style="margin-left:10px;display:none" onclick="document.getElementById('newmolcanv').style.display='';findasgr('{{ maps.0.pk }},{{ maps.1.pk }},{{ maps.2.pk }}','newmolcanv');" class="btn btn-sm btn-success">Display compounds</a>
    <a data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Remove those compounds from the 3D display" id="mmprembutt" style="display:none" onclick="runCommand('GRAPHICS.l_redraw = no');runCommand('delete a_MOL*.*');runCommand('GRAPHICS.l_redraw = yes');runCommand('display new');" class="btn btn-sm btn-warning">Remove </a>
    <a data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Show the highlighted Residue" id="showresbutt" style="" onclick="runCommand('me = String(Res(as_graph))');var my_out = getVar('me');alert(my_out);" class="btn btn-sm btn-info">Show Res</a>

<a onclick="makeBox();" class="btn btn-sm btn-success">Make box</a>
<a onclick="runCommand('undisplay box');" class="btn btn-sm btn-success">Hide box</a>
<a onclick="re_select_data();" class="btn btn-sm btn-success">Search!!!</a>
<a href="{% url 'WONKA:ShowObservations' target.pk %}"  class="btn btn-sm btn-success">Show Observations</a>
<a onclick="download_state();" class="btn btn-sm btn-success">Download state</a>
<p></p>
{% if user.is_authenticated %}
<h4>Hi {{ user.first_name }} - make a comment</h4>

<div  id="LOGIN" class="col-lg-6" >
	<div id="out_link"></div>
    <div class="form-group">
        <label for="inputComments">Comments</label>
        <input type="Comments" class="form-control" id="inputComments" placeholder="Comments">
    </div>
    <a onclick="save_state();" class="btn btn-sm btn-success">Save states</a>
</div>
{% else %}
    <h3>Please log in or register.</h3>

 	 <div  id="LOGIN" class="col-lg-6" >
    <div class="form-group">
        <label for="inputFirstName">First Name</label>
        <input type="First Name" class="form-control" id="inputFirstName" placeholder="First Name">
    </div>
    <div class="form-group">
        <label for="inputLastName">Last Name</label>
        <input type="Last Name" class="form-control" id="inputLastName" placeholder="Last Name">
    </div>
    <div class="form-group">
        <label for="inputEMail">E-mail</label>
        <input type="E-Mail" class="form-control" id="inputEMail" placeholder="E-mail">
    </div>
    <div class="form-group">
        <label for="inputPassword">Password</label>
        <input type="Password" class="form-control" id="inputPassword" placeholder="Password"">
    </div>
    <div class="form-group">
        <label for="inputConfPassword">Confirm Password</label>
        <input type="Password" class="form-control" id="inputConfPassword" placeholder="Confirm Password"">
    </div>
    <a onclick="register();" class="btn btn-sm btn-success">Register</a>
	</div>
	 	 <div class="col-lg-6" >

    <div class="form-group">
        <label for="inputEMailLOG">E-mail</label>
        <input type="E-Mail" class="form-control" id="inputEMailLOG" placeholder="E-mail">
    </div>
    <div class="form-group">
        <label for="inputPasswordLOG">Password</label>
        <input type="Password"" class="form-control" id="inputPasswordLOG" placeholder="Password"">
    </div>
    <a onclick="login();" class="btn btn-sm btn-success">Login</a>
	</div>
	{% endif %}




    </div>

	</div>
    
    

    
  
  
</div>
</body>
</html> 